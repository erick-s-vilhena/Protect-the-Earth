<!DOCTYPE html>
<html>
<head>
    <title>Círculo Controlável (W/A/D/E)</title>
</head>
<body>
    <canvas id="meuCanvas" width="600" height="600"></canvas>

    <script>
        const canvas = document.getElementById('meuCanvas');
        const ctx = canvas.getContext('2d');

        // Objeto do círculo vermelho
        const circuloVermelho = {
            x: 300,
            y: 300,
            raio: 50,
            cor: 'red',
            angulo: 0,  // Ângulo atual (radianos)
            velocidadeRotacao: 0.05,  // Velocidade de rotação
            velocidadeMovimento: 3,  // Velocidade de avanço (W)
        };

        // Objeto do círculo azul (na borda superior do vermelho)
        const circuloAzul = {
            x: 300,
            y: circuloVermelho.y - circuloVermelho.raio + 20,
            raio: 20,
            cor: 'blue',
        };

        // Objeto do círculo verde (dentro do vermelho)
        const circuloVerde = {
            x: 300,
            y: 300,
            raio: 15,
            cor: 'green',
            velocidadeMovimento: 5,  // Velocidade de avanço (E)
            estaAtivo: false,  // Controla se está se movendo sozinho
        };

        // Controles de teclado
        let teclaAPressionada = false;
        let teclaDPressionada = false;
        let teclaWPressionada = false;
        let teclaEPressionada = false;

        // Eventos de teclado
        document.addEventListener('keydown', (e) => {
            if (e.key === 'a') teclaAPressionada = true;
            if (e.key === 'd') teclaDPressionada = true;
            if (e.key === 'w') teclaWPressionada = true;
            if (e.key === 'e') {
                teclaEPressionada = true;
                circuloVerde.estaAtivo = true;  // Ativa o movimento do verde
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'a') teclaAPressionada = false;
            if (e.key === 'd') teclaDPressionada = false;
            if (e.key === 'w') teclaWPressionada = false;
            if (e.key === 'e') teclaEPressionada = false;
        });

        // Função de animação
        function desenhar() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Rotação para ESQUERDA (A)
            if (teclaAPressionada) {
                circuloVermelho.angulo -= circuloVermelho.velocidadeRotacao;
            }
            // Rotação para DIREITA (D)
            if (teclaDPressionada) {
                circuloVermelho.angulo += circuloVermelho.velocidadeRotacao;
            }
            // Movimento para FRENTE (W)
            if (teclaWPressionada) {
                const direcaoX = Math.sin(circuloVermelho.angulo);
                const direcaoY = -Math.cos(circuloVermelho.angulo);
                circuloVermelho.x += direcaoX * circuloVermelho.velocidadeMovimento;
                circuloVermelho.y += direcaoY * circuloVermelho.velocidadeMovimento;
            }

            // Movimento AUTÔNOMO do círculo verde (E)
            if (circuloVerde.estaAtivo) {
                const direcaoX = Math.sin(circuloVermelho.angulo);
                const direcaoY = -Math.cos(circuloVermelho.angulo);
                circuloVerde.x += direcaoX * circuloVerde.velocidadeMovimento;
                circuloVerde.y += direcaoY * circuloVerde.velocidadeMovimento;
            }

            // Atualiza a posição do círculo azul (sempre na borda do vermelho)
            circuloAzul.x = circuloVermelho.x;
            circuloAzul.y = circuloVermelho.y - circuloVermelho.raio + circuloAzul.raio;

            // Desenha o círculo vermelho (sem rotação)
            ctx.beginPath();
            ctx.arc(circuloVermelho.x, circuloVermelho.y, circuloVermelho.raio, 0, Math.PI * 2);
            ctx.fillStyle = circuloVermelho.cor;
            ctx.fill();
            ctx.closePath();

            // Aplica rotação para desenhar o círculo azul (indicador de direção)
            ctx.save();
            ctx.translate(circuloVermelho.x, circuloVermelho.y);
            ctx.rotate(circuloVermelho.angulo);
            ctx.beginPath();
            ctx.arc(0, -circuloVermelho.raio + circuloAzul.raio, circuloAzul.raio, 0, Math.PI * 2);
            ctx.fillStyle = circuloAzul.cor;
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            // Desenha o círculo verde (dentro do vermelho)
            ctx.beginPath();
            ctx.arc(circuloVerde.x, circuloVerde.y, circuloVerde.raio, 0, Math.PI * 2);
            ctx.fillStyle = circuloVerde.cor;
            ctx.fill();
            ctx.closePath();

            requestAnimationFrame(desenhar);
        }

        desenhar(); // Inicia a animação
    </script>
</body>
</html>